---
title: "GCVieweR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{GCVieweR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
devtools::load_all()
library(knitr)
library(kableExtra)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Installation

**GCVieweR** is available through GitHub

``` r
# install.packages("devtools")
devtools::install_github("nvelden/GCVieweR")
```

## Cluster Visualization

### Single Gene Cluster

To visualize a single gene cluster, the minimum requirements are the start and stop positions of each gene, typically named "start" and "stop". In addition a group can be defined which is used for color coding the genes and is used by default as the categorical variable for the legend.

```{r echo=TRUE, results='asis'}
# Example data for a single Gene cluster
gene_cluster <- data.frame(
  name = c("ophB1", "ophC", "ophA", "ophD", "ophB2", "ophP", "ophE"),
  start = c(2522, 5286, 9536, 12616, 13183, 19346, 20170),
  stop = c(4276, 4718, 10904, 11859, 15046, 16016, 21484),
  class = c("Monooxygenase", "NTF2-like", "Methyltransferase", 
  "O-acyltransferase", "Monooxygenase", "Prolyloligopeptidase", 
  "F-box/RNHI-like")
)
GC_chart(gene_cluster, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         height = "200px"
         )
```

### Multiple Gene Clusters

For visualizing multiple gene clusters, an additional variable is needed which is used to define the clusters (as shown in the 'cluster' column below). 

```{r echo=TRUE, results='asis'}
# Example data for two Gene clusters
gene_clusters <- data.frame(
  name = c("ophB1", "ophC", "ophA", "ophD", "ophB2", "ophP", "ophE", 
           "dbophE", "dbophP", "dbophB4", "dbophD2", "dbophA", "dbophB3", "dbophD1", "dbophC", "dbophB2", "dbophB1"), 
  start = c(2522, 5286, 9536, 12616, 13183, 19346, 20170, 
            20583, 21283, 27217, 27371, 28937, 32392, 36331, 37262, 40469, 40768), 
  stop = c(4276, 4718, 10904, 11859, 15046, 16016, 21484, 
           19236, 24607, 25288, 28885, 30516, 34679,  34955, 37791, 38089, 43005), 
  class = c("Monooxygenase", "NTF2-like", "Methyltransferase", "O-acyltransferase", "Monooxygenase", "Prolyloligopeptidase", "F-box/RNHI-like",
            "F-box/RNHI-like", "Prolyloligopeptidase", "Monooxygenase", "O-acyltransferase", "Methyltransferase", 
  "Monooxygenase", "O-acyltransferase", "NTF2-like", "Monooxygenase", "Monooxygenase"), 
  cluster = c("ophA", "ophA", "ophA", "ophA", "ophA", "ophA", "ophA", 
              "dbophA","dbophA", "dbophA", "dbophA", "dbophA", "dbophA", "dbophA", "dbophA", "dbophA", "dbophA") 
)
GC_chart(gene_clusters, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         cluster = "cluster", 
         height = "300px"
         )
```


## Customization

### Labels

To each gene cluster one can add a title, gene labels, a cluster label and a footer as shown in the example below. 

```{r echo=TRUE, results='asis'}
GC_chart(gene_clusters, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         cluster = "cluster", 
         height = "420px"
         ) %>%
  GC_title(
    title = c("Gene Cluster"), 
    subtitle = c("Omphalotus Olearius", "Dendrothele Bisporus")
    ) %>%
  GC_labels("name") %>%
  GC_clusterLabel(title = unique(gene_clusters$cluster)) %>%
  GC_footer(
    title = c("Nr. of Genes: 7", "Nr. of Genes: 10"), 
    subtitle = c("Locus: 2522 - 21,484", "Locus 19,236 - 43,005")
    )
```

To adjust the positioning of labels, the x, y, and position variables can be used. Note that in this example, GC_labels() is employed twice: initially, it sets labels uniformly for all gene clusters, and then it specifically adjusts the fourth label (considering the index starts at 0) in cluster 2, to ensure there is no overlap.

```{r echo=TRUE, results='asis'}
GC_chart(gene_clusters, start = "start", stop = "stop", group = "class", cluster = "cluster", height = "360px") %>%
  GC_title(c("Omphalotus Olearius", "Dendrothele Bisporus"), position = "left", x = 20) %>%
  GC_labels("name", y = 25) %>%
  GC_labels("name", cluster = 2, y = 25, itemStyle = list(list(index = 3, y = 50))) %>%
  GC_footer(title = c("Nr. of Genes: 7", "Nr. of Genes: 10"), subtitle = c("Locus: 2522 - 21,484", "Locus 19,236 - 43,005"), position = "center", y = -30)
```

To adjust the position or styling of specific labels one can use the cluster and itemStyle variables. With the cluster variable one can select a specific cluster by their name or number. Using itemStyle variable one can provide a list with the index number of a specific label and the styles that should be applied to it. Note that the index for itemStyle starts with 0.

```{r echo=TRUE, results='asis'}
GC_chart(gene_clusters, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         cluster = "cluster", 
         height = "360px") %>%
  GC_labels("name", y = 30) %>%
  GC_labels("name", 
            cluster = 2, 
            y = 30,
            itemStyle = list(
              list(index = 3, y = 50, fill = "red"),
              list(index = 7, y = 50, fill = "red")
              )
            )
```

For more detailed examples on how to adjust styling, positioning, and settings for these elements, see the Reference documentation of each function.

### Colors

The color of the legend and genes can be controlled through the `colorScheme` and `customColors` variables.

#### colorScheme

Defines a predefined color scheme for the legend, such as "schemeCategory10" or "schemeAccent" from D3.js. To maintain consistency in color representation apply the same `colorScheme` to both the legend and the gene elements. 

```{r echo=TRUE, results='asis'}
GC_chart(gene_cluster, start = "start", stop = "stop", group = "class", height = "100px") %>%
  GC_legend(legendOptions = list(colorScheme = "schemeAccent")) %>%
  GC_genes(colorScheme = "schemeAccent")
```

#### customColors

Defines a predefined set of colors, customColors allows for specifying exact colors for each group in the legend. 

```{r echo=TRUE, results='asis'}
custom_color_map =c("#F8766D","#00BA38","#619CFF","#F564E3","#FFC61E","#00BFC4")

GC_chart(gene_cluster, start = "start", stop = "stop", group = "class", height = "100px") %>%
  GC_legend(legendOptions = list(customColors = custom_color_map)) %>% 
  GC_genes(customColors = custom_color_map)
```

### Scale 

#### Scale Breaks

In the `GC_chart()` function, the parameters `scale_breaks`, `scale_break_threshold`, and `scale_break_padding` can be used to avoid issues with widely spaced genes within a cluster. Setting `scale_breaks` to TRUE introduces breaks in the genomic scale which will avoid long empty stretches. The `scale_break_threshold` defines the spacing percentage between genes needed to activate these breaks. `scale_break_padding` controls the padding around these breaks.

```{r echo=TRUE, results='asis'}
# Without scale breaks
GC_chart(gene_cluster, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         height = "100px", 
         scale_breaks = FALSE)
```

#### Scale Adjustments

By default the minimum and maximum of the genes start and stop positions are used to position the genes along the sequence. Using the GC_scale function one can specify the values. In addition one can add breaks in the sequence which will be excluded.

```{r echo=TRUE, results='asis'}
# Without custom scale
GC_chart(gene_clusters, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         cluster = "cluster",
         height = "200px") %>%
  GC_coordinates()
```

```{r echo=TRUE, results='asis'}
# Without custom scale
GC_chart(gene_clusters, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         cluster = "cluster",
         height = "200px") %>%
  GC_scale(
    
  )
```



```{r echo=TRUE, results='asis'}
# With scale breaks
GC_chart(gene_cluster, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         height = "100px", 
         scale_breaks = TRUE,
         scale_break_threshold = 20,
         scale_break_padding = 1)
```

### Sequence



### Grid

The GC_grid() function can be used to modify the grid of all or a specific cluster. In the below example the height and margins are adjusted for the second gene cluster.

```{r echo=TRUE, results='asis'}
# With scale breaks
GC_chart(gene_clusters, 
         start = "start", 
         stop = "stop", 
         group = "class", 
         cluster = "cluster",
         height = "200px" # Total height 
                          # since there are 2 clusters in the data 
                          # the height will be 200px each
         ) %>% 
  GC_grid(
    cluster = 2, # Set to NULL to adjust all clusters
    height = "80px",
    margin = list(left = "5px", right = "5px", top = "0px", bottom = "0px")
  )
```
